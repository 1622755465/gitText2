<<<<<<< HEAD
=======
<<<<<<< HEAD
=======
<<<<<<< HEAD
=======
<<<<<<< HEAD
=======
<<<<<<< HEAD
=======
<<<<<<< HEAD
=======
<<<<<<< HEAD
>>>>>>> 19b8a9c (first)
>>>>>>> 8f5179a (first)
>>>>>>> 87a8fdf (first)
>>>>>>> 1e8021d (first)
>>>>>>> 5938de4 (first)
>>>>>>> c55f785 (first)
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>温州医科大学智能监控平台</title>
    <link rel="stylesheet" href="../public/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css"
          href="../public/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css">
    <script src="http://cdn.hcharts.cn/highcharts/highcharts.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="../assets/css/common.css">
    <link rel="stylesheet" href="../assets/css/navigation.css">
    <link rel="stylesheet" href="../assets/css/dianli.css">
    <link rel="stylesheet" href="../assets/css/ele-monitor.css">
    <link rel="stylesheet" href="../assets/css/power_check.css">
    <link rel="stylesheet" href="../assets/css/harmonic.css">

    <style>
        .dtc-main-right-custom {
            margin: 10px 0 20px 0;
            width: 100%;
        }

        .has-gutter tr, .el-table th {
            opacity: 0.8;
            background: #384E7C;
            border-radius: 2px;
        }

        .has-gutter .cell {
            font-size: 16px;
            color: #FFFFFF;
            text-align: left;
        }

        .el-table--striped .el-table__body tr.el-table__row--striped td {
            background: #F0F0F0;
        }

        .ele-div .el-icon-arrow-left:before {
            content: "上一页";
        }

        .ele-div .el-icon-arrow-right:before {
            content: "下一页";
            margin: 0;
            width: auto;
        }

        .ele-div .el-pagination.is-background .el-pager li:not(.disabled).active {
            background: #13B6CC;
        }

        .ele-div .el-pagination .btn-prev, .ele-div .el-pagination .btn-next {
            font-size: 12px;
            width: 5em;
            padding: 0em 1em;
            background: #13B6CC;
            color: #FFFFFF;

        }

        .ele-div .el-pagination .btn-prev i, .ele-div .el-pagination .btn-next i {
            font-weight: normal;
        }

        .ele-div .el-pagination {
            text-align: right;
        }

        .ele-div .number {
            font-size: 12px;
            color: #666666 !important;
            font-weight: normal;
        }

        .ele-div .active {
            color: #FFFFFF !important;
        }

        .el-pagination button:disabled {
            background-color: #EFF2F5 !important;
        }

        .dtc-ele-span {
            font-size: 14px;
            color: #414E69;
            float: left;
        }

        .dt-harmonic-from-group-custom {
            width: 250px;
        }
        .dtn-control-label{
            margin-right:5px;
        }
    </style>
</head>
<body style="background-color:#F0F3F8 ">
<div id="app">
    <div class="dt-title-container dtn-title-container">
        <div class="dt-nav-title dtn-nav-title">温州医科大学智能监控平台</div>
        <div class="dt-nav-logo dtn-nav-logo">
            管理员,&nbsp;&nbsp;你好&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../assets/img/ic-dropout.png"
                                                                 class="dt-nav-quit dtn-nav-quit dtc-com-cur"><span
                class="dt-nav-quit dtc-com-cur dtc-com-mar">退出登录</span>
        </div>
    </div>
    <div class="dt-nav-container dtn-nav-container">
        <div class="dt-nav-btn active dt-nav-option-active dtn-nav-btn"
             onclick="javascript:window.location.href='main'">
            <span class="dt-nav-img dt-nav-general dtn-generalization-img"
                  style="background: url(../assets/img/ic-overview-gray.png) no-repeat;"></span>
            <span style="cursor:default;" class="dtn-nav-list">概况</span>
        </div>
        <div class="dt-nav-btn dtn-nav-btn" onclick="javascript:window.location.href='eleMonitor'">
            <span class="dt-nav-img dt-nav-monitor dtn-monitor-img"></span>
            <span style="cursor:default;" class="dtn-nav-list">变压器监测</span>
        </div>
        <div class="dt-nav-btn dtn-nav-btn" onclick="javascript:window.location.href='harmonic'">
            <span class="dt-nav-img dt-nav-quality dtn-quality-img"></span>
            <span class="dtn-nav-list">电力监测</span>
        </div>
        <!--<div class="dt-nav-btn">-->
        <!--<span class="dt-nav-img dt-nav-analysis"></span>-->
        <!--用电分析-->
        <!--</div>-->
        <!--<div class="dt-nav-btn">-->
        <!--<span class="dt-nav-img dt-nav-security"></span>-->
        <!--安全分析-->
        <!--</div>-->
        <!--<div class="dt-nav-btn">-->
        <!--<span class="dt-nav-img dt-nav-record"></span>-->
        <!--事件记录-->
        <!--</div>-->
        <div class="dt-nav-btn dtn-nav-btn" onclick="javascript:window.location.href='environment'">
            <span class="dt-nav-img dt-nav-environment dtn-environment-img"></span>
            <span class="dtn-nav-list">环境监测</span>
        </div>
        <!--<div class="dt-nav-btn ">-->
        <!--<span class="dt-nav-img dt-nav-administration"></span>-->
        <!--维护管理-->
        <!--</div>-->
        <div class="dt-nav-btn dtn-nav-btn">
            <span class="dt-nav-img dt-nav-warning dtn-warning-img"
                  style="background: url(../assets/img/ic-police-blue.png) no-repeat"></span>
            <span class="dtn-nav-list" style="opacity: 1;color: #414E69;">报警监测</span>
            <div class="dtn-item-hr"></div>
        </div>
        <div class="dt-nav-btn dtn-nav-btn" onclick="javascript:window.location.href='plan'">
            <span class="dt-nav-img dt-nav-record dtn-record-img"></span>
            <span class="dtn-nav-list">巡察计划</span>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-2 col-lg-2">
                <div class="dt-left-nav-container dtn-left-nav-container">
                    <div class="dtn-empty-div"></div>
                    <div class="dt-left-nav-box dt-left-nav-box-active dtn-left-nav-box">图书馆</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">同仁楼</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">同德楼</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">同济楼</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">学生活动中心</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">一期宿舍</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">二期宿舍</div>
                    <!--<div class="dt-left-nav-box">三期宿舍上</div>-->
                    <!--<div class="dt-left-nav-box">三期宿舍下</div>-->
                    <div class="dt-left-nav-box dtn-left-nav-box">中试基地</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">学院路2#</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">求是楼</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">三期宿舍食堂</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">学院路1#</div>
                </div>
            </div>
            <div class="col-md-10 col-lg-10">
                <div class="dt-main-container">
                    <div style="margin: 0 10px">
                        <div class="row dtc-main-right-custom">
                            <div class="dt-harmonic-date-select">
                                <div class="form-group form-group-custom dt-harmonic-from-group-custom"
                                     style="margin-bottom: 0;">
                                    <label for="dtp_inputStart" class="control-label dtn-control-label">起止时间：</label>
                                    <div class="input-group date form_date dt-harmonic-input-group-custom dtn-big-div"
                                         data-date=""
                                         data-date-format="dd MM yyyy" data-link-field="dtp_input2"
                                         data-link-format="yyyy-mm-dd"
                                         id="datetimepickerStart">
                                        <input class="form-control dtn-form-control" size="16" type="text" value=""
                                               readonly
                                               id="daycalendarBoxBegin">
                                        <!--<span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>-->

                                        <span class="input-group-addon dtn-input-group-addon dtn-big-span"><span
                                                class="glyphicon glyphicon-calendar dtn-span"></span><img
                                                src="../assets/img/btn_time.png" height="14" width="15"/></span>
                                    </div>
                                    <input type="hidden" id="dtp_inputStart" value="" data-format="yyyy-MM-dd hh:mm:ss"
                                           type="text"/><br/>
                                </div>
                                <div class="form-group form-group-custom dt-harmonic-from-group-custom"
                                     style="margin-bottom: 0;">
                                    <label for="dtp_inputEnd" class="control-label dtn-control-label">结束日期：</label>
                                    <div class="input-group date form_date dt-harmonic-input-group-custom dtn-big-div"
                                         data-date=""
                                         data-date-format="dd MM yyyy" data-link-field="dtp_input2"
                                         data-link-format="yyyy-mm-dd"
                                         id="datetimepickerEnd">
                                        <input class="form-control dtn-form-control" size="16" type="text" value=""
                                               readonly id="daycalendarBoxEnd">
                                        <!--<span class="input-group-addon dtn-input-group-addon dtn-big-span"><span class="glyphicon glyphicon-remove"></span></span>-->
                                        <span class="input-group-addon dtn-input-group-addon dtn-big-span"><span
                                                class="glyphicon glyphicon-calendar dtn-span"></span><img
                                                src="../assets/img/btn_time.png" height="14" width="15"/></span>
                                    </div>
                                    <input type="hidden" id="dtp_inputEnd" value="" data-format="yyyy-MM-dd hh:mm:ss"
                                           type="text"/><br/>
                                </div>
                                <label class="dt-harmonic-power-type dtn-harmonic-power-type">类别：</label>
                                <div id="hideDiv">0</div>
                                <select class="dt-harmonic-select dtn-harmonic-select" id="select">
                                    <option value="0">A相过载报警</option>
                                    <option value="1">B相过载报警</option>
                                    <option value="2">C相过载报警</option>
                                    <option value="3">A相余量报警</option>
                                    <option value="4">B相余量报警</option>
                                    <option value="5">C相余量报警</option>
                                    <option value="6">变压器跳闸</option>
                                    <option value="7">变压器超温</option>
                                    <option value="8">断路器报警</option>
                                </select><img src="../assets/img/btn_dropdown.png" alt=""
                                              class="dtn-monitor-img-down" height="6" width="10"/>
                                <!--<input type="checkbox" class="dt-harmonic-check-box" id="fla">-->
                                <!--<span id="noteA">A相</span>-->
                                <!--<input type="checkbox" class="dt-harmonic-check-box" id="flb">-->
                                <!--<span id="noteB">B相</span>-->
                                <!--<input type="checkbox" class="dt-harmonic-check-box" id="flc">-->
                                <!--<span id="noteC">C相</span>-->
                                <!--<button class="middle-button">上一日</button>-->
                                <!--<button class="middle-button">下一日</button>-->
                                <div class="dtn-button-div">
                                    <button class="middle-button dt-btn-check-search dtn-button-middle dtn-button-search"
                                            style="padding: 0" id="search">查询
                                    </button>
                                    <button class="middle-button dtn-button-middle dtn-button-outPut" id="outPut"
                                            style="" onclick="outPut()">导出
                                    </button>
                                </div>
                            </div>
                            <div class="dt-harmonic-sheet" id="sheetContainer" style="margin-top: 10px;" v-cloak>
                                <div class="table-responsive table-responsive-custom"
                                     style="height: 100%; overflow:  scroll;display: none">
                                    <table class="table table-striped table-custom" id="outPutTable">
                                        <thead class="main-box-top">
                                        <tr>
                                            <th>序号</th>
                                            <th>配电房名称</th>
                                            <th>柜体名称</th>
                                            <th>回路名称</th>
                                            <th>时间</th>
                                            <th>事件描述</th>
                                        </tr>
                                        </thead>
                                        <tr v-for="(list,index) in list">
                                            <th>${index+1}</th>
                                            <th class="home">${home}</th>
                                            <th>${list.boxName}</th>
                                            <th>${list.loopName}</th>
                                            <th>${list.DT | timeFilter}</th>
                                            <th v-if="type!=8">${event}</th>
                                            <th v-else="type==8">${list.event}</th>
                                        </tr>
                                    </table>

                                </div>
                                <div class="ele-div">

                                    <div class="block" style="padding: 20px 20px 10px 20px;background-color: white">
                                        <div class="container_table">
                                            <el-table
                                                    :data="tableData.slice((currentPage-1)*pagesize,currentPage*pagesize)"
                                                    stripe
                                                    style="width: 100%"
                                                    :default-sort="{prop: 'date', order: 'descending'}"
                                            >
                                                <el-table-column
                                                        prop="index"
                                                        label="序号"

                                                        width="180">
                                                </el-table-column>
                                                <el-table-column
                                                        prop="home"
                                                        label="配电房名称"
                                                        width="180">
                                                </el-table-column>
                                                <el-table-column
                                                        prop="boxName"

                                                        label="柜体名称">
                                                </el-table-column>
                                                <el-table-column
                                                        prop="loopName"

                                                        label="回路名称">
                                                </el-table-column>
                                                <el-table-column
                                                        prop="DT|timeFilter"
                                                        label="时间">
                                                </el-table-column>
                                                <el-table-column
                                                        prop="event"
                                                        v-if="type!=8"
                                                        label="事件描述">
                                                </el-table-column>
                                                <el-table-column
                                                        prop="list.event"
                                                        v-if="type==8"
                                                        label="事件描述">
                                                </el-table-column>

                                            </el-table>
                                            <div style="margin-top: 10px"><span
                                                    class="dtc-ele-span">共<span>${total}</span>条</span>
                                                <el-pagination layout="prev, pager, next"
                                                               @current-change="current_change"
                                                               :total="total"
                                                               background
                                                >
                                                </el-pagination>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dtn-footer">
                    版本所有：温州医科大学&nbsp;地址：浙江省温州茶山高教园区
                </div>
            </div>
        </div>
    </div>
</div>
<!--<div class="dt-footer">登录用户：admin</div>-->
<script type="text/javascript" src="../public/jquery/js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="../public/bootstrap/js/bootstrap.min.js"></script>
<script src="../public/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="../public/bootstrap-datetimepicker/js/bootstrap-datetimepicker.zh-CN.js"></script>
<script src="../public/FileSaver/FileSaver.min.js"></script>
<script src="../public/js-xlsx/xlsx.core.min.js"></script>
<script type="text/javascript" src="../public/tableExport.min.js"></script>
<script src="https://cdn.bootcss.com/axios/0.18.0/axios.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script type="text/javascript" src="../public/xlsx/xlsx.core.min.js"></script>
<script type="text/javascript" src="../public/xlsx/xlsx.full.min.js"></script>
<script src="../public/helper/dt-epo-helpers.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        // function outPut() {
        //     $('#outPutTable').tableExport({type: 'excel'});
        // }

        function logOut() {
            sessionStorage.removeItem('user');
            sessionStorage.removeItem('isLogin');
            window.location.href = 'index';
        }

        function logOut() {
            sessionStorage.removeItem('user');
            sessionStorage.removeItem('isLogin');
            window.location.href = 'index';
        }

        $('.dt-nav-quit').click(function () {
            logOut();
        });
    });

    function outPut() {
        // $('#outPutTable').tableExport({type: 'excel'});
        vm.isXlsx = true;
        if (compareDate($('#daycalendarBoxBegin').val(), $('#daycalendarBoxEnd').val())) {
            search(vm, getArgs());
        }
    }

    var homeList = ['图书馆', '同德楼', '同济楼', '同仁楼', '三期宿舍上', '三期宿舍下', '求是楼', '中试基地', '同德楼', '学院路1#', '学院路2#'
        , '一起宿舍', '二期宿舍'];
    var deskList = ['I进线柜', 'II进线柜'];
    var loopLiList = ['跳闸动作', '超温'];
    sessionStorage.setItem('home', '图书馆');
    var startDate = new Date();
    startDate.setFullYear(2018, 6, 1);
    var endDate = new Date();
    endDate.setFullYear(2018, 6, 31);
    $('.form_date').datetimepicker({
        language: 'zh-CN',
        format: 'yyyy-mm-dd',
        weekStart: 1,
        todayBtn: 1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0,
//        startDate: startDate,
//       endDate: endDate
    });

    $('.dt-left-nav-box').click(function () {
        $('.dt-left-nav-box-active').removeClass('dt-left-nav-box-active');
        $(this).addClass('dt-left-nav-box-active');
//        var home = $(this).html().toString();
//        $('.home').html(home);
        search(vm, getArgs());
    });

    $("#search").click(function () {
        //getWarning();
        if (compareDate($('#daycalendarBoxBegin').val(), $('#daycalendarBoxEnd').val())) {
            search(vm, getArgs());
        }
    });

    var vm = new Vue({
        el: "#sheetContainer",
        delimiters: ['${', '}'],
        data: {
            list: [],
            homeList: ['图书馆', '同德楼', '同济楼', '同仁楼', '三期宿舍上', '三期宿舍下', '求是楼', '中试基地', '同德楼', '学院路1#', '学院路2#'
                , '一起宿舍', '二期宿舍'],
            home: $('.dt-left-nav-box-active').html(),
            event: '',
            type: 0,

            total: 0,//默认数据总数
            pagesize: 11,//每页的数据条数
            currentPage: 1,//默认开始页面
            istag: true,
            tableData: [],
            isXlsx: false,
        },
        methods: {
            // 数据页面
            tableRowClassName({row, rowIndex}) {
                if (rowIndex === 0) {
                    return 'th';
                }
                return '';
            },
            switchChange() {
                this.istag = !this.istag;

            },
            created: function () {
                this.total = this.tableData.length;
            },
            current_change: function (currentPage) {
                this.currentPage = currentPage;
            },

            // end
        },
        created: function () {

            var isLogin = sessionStorage.getItem('isLogin') || false;
            if (!isLogin) {
                window.location.href = 'index';
            }

            $('#daycalendarBoxBegin').val(new Date().format("yyyy-MM-dd"));
            $('#daycalendarBoxEnd').val(new Date().format("yyyy-MM-dd"));
            var args = {
                "home": "00",
                "type": 1,
                "startTime": new Date().format("yyyy-MM-dd").toString(),
                "endhTime": new Date().format("yyyy-MM-dd").toString()
            };
            search(this, args);
        },
        filters: {
            timeFilter: function (value) {
                var time = new Date(value).format('yyyy-MM-dd hh:mm:ss').toString();
                return time;
            }
        }
    });

    function search(obj, args) {
        const loading = obj.$loading({
            lock: true,
            text: '查找数据中',
            spinner: 'el-icon-loading',
            background: 'rgba(0, 0, 0, 0.7)'
        });

        obj.list = [];
        obj.tableData = [];
        obj.home = $('.dt-left-nav-box-active').html();


        var apicode = "AlarmInfo";
        //console.log($('#daycalendarBoxEnd').val()-$('#daycalendarBoxBegin').val());
//        compareDate($('#daycalendarBoxBegin').val(), $('#daycalendarBoxEnd').val());
        if (args.type === 8) {
            apicode = "AlarmBreak";
        }

        axios.post("/api", {
            "apicode": apicode,
            "args": args
        }, {
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(function (res) {
            loading.close();
            if (res.data.obj.length > 0) {
                obj.total = res.data.obj.length;
                var arr = {};
                var event = $("#select").find("option:selected").text();
                var home = $('.dt-left-nav-box-active').html().toString();
                for (var i = 0; i < res.data.obj.length; i++) {
                    arr = {
                        index: i + 1,
                        home: home,
                        boxName: res.data.obj[i].boxName,
                        loopName: res.data.obj[i].loopName,
                        DT: res.data.obj[i].DT,
                        event: event,
                    };
                    obj.tableData[i] = arr;
                }
                if (obj.isXlsx) {
                    var art = [];
                    art = obj.tableData;
                    var sheet = XLSX.utils.json_to_sheet(art);
                    openDownloadDialog(sheet2blob(sheet), obj.home + '.xlsx');
                    obj.isXlsx = false;
                }
            } else {
                loading.close();
                obj.$message.error('暂无当前数据');
            }

        }).catch(function (error) {
            loading.close();
            console.log(error);
        });
    }


    function getWarning() {
        var args = {};
        args['powerType'] = parseInt($("#select").val());
        args['startTime'] = $("#datetimepickerStart").data("datetimepicker").getDate();
        var startTime = args.startTime;
        args.startTime = startTime.getFullYear() + "-" + (startTime.getMonth() + 1) + "-" + startTime.getDate();
        args['endhTime'] = $("#datetimepickerEnd").data("datetimepicker").getDate();
        var endhTime = args.endhTime;
        args.endhTime = endhTime.getFullYear() + "-" + (endhTime.getMonth() + 1) + "-" + endhTime.getDate();
    }

    function getArgs() {
        var startTime = $('#daycalendarBoxBegin').val();
        var endhTime = $('#daycalendarBoxEnd').val();
        var home = homeKeySwitch($('.dt-left-nav-box-active').html().toString());
        var type = parseInt($("#select").val());
        vm.type = type;
        var args = {
            "home": home,
            "type": type,
            "startTime": startTime,
            "endTime": endhTime
        };

        return args;
    }

    function homeKeySwitch(str) {
        var homeKey = '';
        switch (str) {
            case '图书馆':
                homeKey = '00';
                break;
            case '同仁楼':
                homeKey = '01';
                break;
            case '同德楼':
                homeKey = '02';
                break;
            case '同济楼':
                homeKey = '03';
                break;
            case '求是楼':
                homeKey = '09';
                break;
            case '学生活动中心':
                homeKey = '04';
                break;
            case '三期宿舍上':
                homeKey = '06';
                break;
            case '三期宿舍下':
                homeKey = '07';
                break;
            case '中试基地':
                homeKey = '07';
                break;
            case '学院路1#':
                homeKey = '11';
                break;
            case '学院路2#':
                homeKey = '08';
                break;
            case '一期宿舍':
                homeKey = '05';
                break;
            case '二期宿舍':
                homeKey = '06';
                break;
            case '三期宿舍食堂':
                homeKey = '10';
                break;
        }
        return homeKey;
    }

    //时间比较（yyyy-MM-dd）
    function compareDate(startDate, endDate) {
        var arrStart = startDate.split("-");
        var startTime = new Date(arrStart[0], arrStart[1], arrStart[2]);
        var startTimes = startTime.getTime();
        var arrEnd = endDate.split("-");
        var endTime = new Date(arrEnd[0], arrEnd[1], arrEnd[2]);
        var endTimes = endTime.getTime();
        if (endTimes < startTimes) {
            vm.$message({
                message: '结束时间不能小于开始时间',
                type: 'warning'
            });
            return false;
        }
        return true;
    }
</script>
</body>
<<<<<<< HEAD
=======
<<<<<<< HEAD
=======
<<<<<<< HEAD
=======
<<<<<<< HEAD
=======
<<<<<<< HEAD
=======
<<<<<<< HEAD
=======
=======
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>温州医科大学智能监控平台</title>
    <link rel="stylesheet" href="../public/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css"
          href="../public/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css">
    <script src="http://cdn.hcharts.cn/highcharts/highcharts.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="../assets/css/common.css">
    <link rel="stylesheet" href="../assets/css/navigation.css">
    <link rel="stylesheet" href="../assets/css/dianli.css">
    <link rel="stylesheet" href="../assets/css/ele-monitor.css">
    <link rel="stylesheet" href="../assets/css/power_check.css">
    <link rel="stylesheet" href="../assets/css/harmonic.css">

    <style>
        .dtc-main-right-custom {
            margin: 10px 0 20px 0;
            width: 100%;
        }

        .has-gutter tr, .el-table th {
            opacity: 0.8;
            background: #384E7C;
            border-radius: 2px;
        }

        .has-gutter .cell {
            font-size: 16px;
            color: #FFFFFF;
            text-align: left;
        }

        .el-table--striped .el-table__body tr.el-table__row--striped td {
            background: #F0F0F0;
        }

        .ele-div .el-icon-arrow-left:before {
            content: "上一页";
        }

        .ele-div .el-icon-arrow-right:before {
            content: "下一页";
            margin: 0;
            width: auto;
        }

        .ele-div .el-pagination.is-background .el-pager li:not(.disabled).active {
            background: #13B6CC;
        }

        .ele-div .el-pagination .btn-prev, .ele-div .el-pagination .btn-next {
            font-size: 12px;
            width: 5em;
            padding: 0em 1em;
            background: #13B6CC;
            color: #FFFFFF;

        }

        .ele-div .el-pagination .btn-prev i, .ele-div .el-pagination .btn-next i {
            font-weight: normal;
        }

        .ele-div .el-pagination {
            text-align: right;
        }

        .ele-div .number {
            font-size: 12px;
            color: #666666 !important;
            font-weight: normal;
        }

        .ele-div .active {
            color: #FFFFFF !important;
        }

        .el-pagination button:disabled {
            background-color: #EFF2F5 !important;
        }

        .dtc-ele-span {
            font-size: 14px;
            color: #414E69;
            float: left;
        }

        .dt-harmonic-from-group-custom {
            width: 250px;
        }
        .dtn-control-label{
            margin-right:5px;
        }
    </style>
</head>
<body style="background-color:#F0F3F8 ">
<div id="app">
    <div class="dt-title-container dtn-title-container">
        <div class="dt-nav-title dtn-nav-title">温州医科大学智能监控平台</div>
        <div class="dt-nav-logo dtn-nav-logo">
            管理员,&nbsp;&nbsp;你好&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="../assets/img/ic-dropout.png"
                                                                 class="dt-nav-quit dtn-nav-quit dtc-com-cur"><span
                class="dt-nav-quit dtc-com-cur dtc-com-mar">退出登录</span>
        </div>
    </div>
    <div class="dt-nav-container dtn-nav-container">
        <div class="dt-nav-btn active dt-nav-option-active dtn-nav-btn"
             onclick="javascript:window.location.href='main'">
            <span class="dt-nav-img dt-nav-general dtn-generalization-img"
                  style="background: url(../assets/img/ic-overview-gray.png) no-repeat;"></span>
            <span style="cursor:default;" class="dtn-nav-list">概况</span>
        </div>
        <div class="dt-nav-btn dtn-nav-btn" onclick="javascript:window.location.href='eleMonitor'">
            <span class="dt-nav-img dt-nav-monitor dtn-monitor-img"></span>
            <span style="cursor:default;" class="dtn-nav-list">变压器监测</span>
        </div>
        <div class="dt-nav-btn dtn-nav-btn" onclick="javascript:window.location.href='harmonic'">
            <span class="dt-nav-img dt-nav-quality dtn-quality-img"></span>
            <span class="dtn-nav-list">电力监测</span>
        </div>
        <!--<div class="dt-nav-btn">-->
        <!--<span class="dt-nav-img dt-nav-analysis"></span>-->
        <!--用电分析-->
        <!--</div>-->
        <!--<div class="dt-nav-btn">-->
        <!--<span class="dt-nav-img dt-nav-security"></span>-->
        <!--安全分析-->
        <!--</div>-->
        <!--<div class="dt-nav-btn">-->
        <!--<span class="dt-nav-img dt-nav-record"></span>-->
        <!--事件记录-->
        <!--</div>-->
        <div class="dt-nav-btn dtn-nav-btn" onclick="javascript:window.location.href='environment'">
            <span class="dt-nav-img dt-nav-environment dtn-environment-img"></span>
            <span class="dtn-nav-list">环境监测</span>
        </div>
        <!--<div class="dt-nav-btn ">-->
        <!--<span class="dt-nav-img dt-nav-administration"></span>-->
        <!--维护管理-->
        <!--</div>-->
        <div class="dt-nav-btn dtn-nav-btn">
            <span class="dt-nav-img dt-nav-warning dtn-warning-img"
                  style="background: url(../assets/img/ic-police-blue.png) no-repeat"></span>
            <span class="dtn-nav-list" style="opacity: 1;color: #414E69;">报警监测</span>
            <div class="dtn-item-hr"></div>
        </div>
        <div class="dt-nav-btn dtn-nav-btn" onclick="javascript:window.location.href='plan'">
            <span class="dt-nav-img dt-nav-record dtn-record-img"></span>
            <span class="dtn-nav-list">巡察计划</span>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-2 col-lg-2">
                <div class="dt-left-nav-container dtn-left-nav-container">
                    <div class="dtn-empty-div"></div>
                    <div class="dt-left-nav-box dt-left-nav-box-active dtn-left-nav-box">图书馆</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">同仁楼</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">同德楼</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">同济楼</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">学生活动中心</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">一期宿舍</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">二期宿舍</div>
                    <!--<div class="dt-left-nav-box">三期宿舍上</div>-->
                    <!--<div class="dt-left-nav-box">三期宿舍下</div>-->
                    <div class="dt-left-nav-box dtn-left-nav-box">中试基地</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">学院路2#</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">求是楼</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">三期宿舍食堂</div>
                    <div class="dt-left-nav-box dtn-left-nav-box">学院路1#</div>
                </div>
            </div>
            <div class="col-md-10 col-lg-10">
                <div class="dt-main-container">
                    <div style="margin: 0 10px">
                        <div class="row dtc-main-right-custom">
                            <div class="dt-harmonic-date-select">
                                <div class="form-group form-group-custom dt-harmonic-from-group-custom"
                                     style="margin-bottom: 0;">
                                    <label for="dtp_inputStart" class="control-label dtn-control-label">起止时间：</label>
                                    <div class="input-group date form_date dt-harmonic-input-group-custom dtn-big-div"
                                         data-date=""
                                         data-date-format="dd MM yyyy" data-link-field="dtp_input2"
                                         data-link-format="yyyy-mm-dd"
                                         id="datetimepickerStart">
                                        <input class="form-control dtn-form-control" size="16" type="text" value=""
                                               readonly
                                               id="daycalendarBoxBegin">
                                        <!--<span class="input-group-addon"><span class="glyphicon glyphicon-remove"></span></span>-->

                                        <span class="input-group-addon dtn-input-group-addon dtn-big-span"><span
                                                class="glyphicon glyphicon-calendar dtn-span"></span><img
                                                src="../assets/img/btn_time.png" height="14" width="15"/></span>
                                    </div>
                                    <input type="hidden" id="dtp_inputStart" value="" data-format="yyyy-MM-dd hh:mm:ss"
                                           type="text"/><br/>
                                </div>
                                <div class="form-group form-group-custom dt-harmonic-from-group-custom"
                                     style="margin-bottom: 0;">
                                    <label for="dtp_inputEnd" class="control-label dtn-control-label">结束日期：</label>
                                    <div class="input-group date form_date dt-harmonic-input-group-custom dtn-big-div"
                                         data-date=""
                                         data-date-format="dd MM yyyy" data-link-field="dtp_input2"
                                         data-link-format="yyyy-mm-dd"
                                         id="datetimepickerEnd">
                                        <input class="form-control dtn-form-control" size="16" type="text" value=""
                                               readonly id="daycalendarBoxEnd">
                                        <!--<span class="input-group-addon dtn-input-group-addon dtn-big-span"><span class="glyphicon glyphicon-remove"></span></span>-->
                                        <span class="input-group-addon dtn-input-group-addon dtn-big-span"><span
                                                class="glyphicon glyphicon-calendar dtn-span"></span><img
                                                src="../assets/img/btn_time.png" height="14" width="15"/></span>
                                    </div>
                                    <input type="hidden" id="dtp_inputEnd" value="" data-format="yyyy-MM-dd hh:mm:ss"
                                           type="text"/><br/>
                                </div>
                                <label class="dt-harmonic-power-type dtn-harmonic-power-type">类别：</label>
                                <div id="hideDiv">0</div>
                                <select class="dt-harmonic-select dtn-harmonic-select" id="select">
                                    <option value="0">A相过载报警</option>
                                    <option value="1">B相过载报警</option>
                                    <option value="2">C相过载报警</option>
                                    <option value="3">A相余量报警</option>
                                    <option value="4">B相余量报警</option>
                                    <option value="5">C相余量报警</option>
                                    <option value="6">变压器跳闸</option>
                                    <option value="7">变压器超温</option>
                                    <option value="8">断路器报警</option>
                                </select><img src="../assets/img/btn_dropdown.png" alt=""
                                              class="dtn-monitor-img-down" height="6" width="10"/>
                                <!--<input type="checkbox" class="dt-harmonic-check-box" id="fla">-->
                                <!--<span id="noteA">A相</span>-->
                                <!--<input type="checkbox" class="dt-harmonic-check-box" id="flb">-->
                                <!--<span id="noteB">B相</span>-->
                                <!--<input type="checkbox" class="dt-harmonic-check-box" id="flc">-->
                                <!--<span id="noteC">C相</span>-->
                                <!--<button class="middle-button">上一日</button>-->
                                <!--<button class="middle-button">下一日</button>-->
                                <div class="dtn-button-div">
                                    <button class="middle-button dt-btn-check-search dtn-button-middle dtn-button-search"
                                            style="padding: 0" id="search">查询
                                    </button>
                                    <button class="middle-button dtn-button-middle dtn-button-outPut" id="outPut"
                                            style="" onclick="outPut()">导出
                                    </button>
                                </div>
                            </div>
                            <div class="dt-harmonic-sheet" id="sheetContainer" style="margin-top: 10px;" v-cloak>
                                <div class="table-responsive table-responsive-custom"
                                     style="height: 100%; overflow:  scroll;display: none">
                                    <table class="table table-striped table-custom" id="outPutTable">
                                        <thead class="main-box-top">
                                        <tr>
                                            <th>序号</th>
                                            <th>配电房名称</th>
                                            <th>柜体名称</th>
                                            <th>回路名称</th>
                                            <th>时间</th>
                                            <th>事件描述</th>
                                        </tr>
                                        </thead>
                                        <tr v-for="(list,index) in list">
                                            <th>${index+1}</th>
                                            <th class="home">${home}</th>
                                            <th>${list.boxName}</th>
                                            <th>${list.loopName}</th>
                                            <th>${list.DT | timeFilter}</th>
                                            <th v-if="type!=8">${event}</th>
                                            <th v-else="type==8">${list.event}</th>
                                        </tr>
                                    </table>

                                </div>
                                <div class="ele-div">

                                    <div class="block" style="padding: 20px 20px 10px 20px;background-color: white">
                                        <div class="container_table">
                                            <el-table
                                                    :data="tableData.slice((currentPage-1)*pagesize,currentPage*pagesize)"
                                                    stripe
                                                    style="width: 100%"
                                                    :default-sort="{prop: 'date', order: 'descending'}"
                                            >
                                                <el-table-column
                                                        prop="index"
                                                        label="序号"

                                                        width="180">
                                                </el-table-column>
                                                <el-table-column
                                                        prop="home"
                                                        label="配电房名称"
                                                        width="180">
                                                </el-table-column>
                                                <el-table-column
                                                        prop="boxName"

                                                        label="柜体名称">
                                                </el-table-column>
                                                <el-table-column
                                                        prop="loopName"

                                                        label="回路名称">
                                                </el-table-column>
                                                <el-table-column
                                                        prop="DT|timeFilter"
                                                        label="时间">
                                                </el-table-column>
                                                <el-table-column
                                                        prop="event"
                                                        v-if="type!=8"
                                                        label="事件描述">
                                                </el-table-column>
                                                <el-table-column
                                                        prop="list.event"
                                                        v-if="type==8"
                                                        label="事件描述">
                                                </el-table-column>

                                            </el-table>
                                            <div style="margin-top: 10px"><span
                                                    class="dtc-ele-span">共<span>${total}</span>条</span>
                                                <el-pagination layout="prev, pager, next"
                                                               @current-change="current_change"
                                                               :total="total"
                                                               background
                                                >
                                                </el-pagination>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dtn-footer">
                    版本所有：温州医科大学&nbsp;地址：浙江省温州茶山高教园区
                </div>
            </div>
        </div>
    </div>
</div>
<!--<div class="dt-footer">登录用户：admin</div>-->
<script type="text/javascript" src="../public/jquery/js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="../public/bootstrap/js/bootstrap.min.js"></script>
<script src="../public/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
<script src="../public/bootstrap-datetimepicker/js/bootstrap-datetimepicker.zh-CN.js"></script>
<script src="../public/FileSaver/FileSaver.min.js"></script>
<script src="../public/js-xlsx/xlsx.core.min.js"></script>
<script type="text/javascript" src="../public/tableExport.min.js"></script>
<script src="https://cdn.bootcss.com/axios/0.18.0/axios.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.js"></script>
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script type="text/javascript" src="../public/xlsx/xlsx.core.min.js"></script>
<script type="text/javascript" src="../public/xlsx/xlsx.full.min.js"></script>
<script src="../public/helper/dt-epo-helpers.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        // function outPut() {
        //     $('#outPutTable').tableExport({type: 'excel'});
        // }

        function logOut() {
            sessionStorage.removeItem('user');
            sessionStorage.removeItem('isLogin');
            window.location.href = 'index';
        }

        function logOut() {
            sessionStorage.removeItem('user');
            sessionStorage.removeItem('isLogin');
            window.location.href = 'index';
        }

        $('.dt-nav-quit').click(function () {
            logOut();
        });
    });

    function outPut() {
        // $('#outPutTable').tableExport({type: 'excel'});
        vm.isXlsx = true;
        if (compareDate($('#daycalendarBoxBegin').val(), $('#daycalendarBoxEnd').val())) {
            search(vm, getArgs());
        }
    }

    var homeList = ['图书馆', '同德楼', '同济楼', '同仁楼', '三期宿舍上', '三期宿舍下', '求是楼', '中试基地', '同德楼', '学院路1#', '学院路2#'
        , '一起宿舍', '二期宿舍'];
    var deskList = ['I进线柜', 'II进线柜'];
    var loopLiList = ['跳闸动作', '超温'];
    sessionStorage.setItem('home', '图书馆');
    var startDate = new Date();
    startDate.setFullYear(2018, 6, 1);
    var endDate = new Date();
    endDate.setFullYear(2018, 6, 31);
    $('.form_date').datetimepicker({
        language: 'zh-CN',
        format: 'yyyy-mm-dd',
        weekStart: 1,
        todayBtn: 1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0,
//        startDate: startDate,
//       endDate: endDate
    });

    $('.dt-left-nav-box').click(function () {
        $('.dt-left-nav-box-active').removeClass('dt-left-nav-box-active');
        $(this).addClass('dt-left-nav-box-active');
//        var home = $(this).html().toString();
//        $('.home').html(home);
        search(vm, getArgs());
    });

    $("#search").click(function () {
        //getWarning();
        if (compareDate($('#daycalendarBoxBegin').val(), $('#daycalendarBoxEnd').val())) {
            search(vm, getArgs());
        }
    });

    var vm = new Vue({
        el: "#sheetContainer",
        delimiters: ['${', '}'],
        data: {
            list: [],
            homeList: ['图书馆', '同德楼', '同济楼', '同仁楼', '三期宿舍上', '三期宿舍下', '求是楼', '中试基地', '同德楼', '学院路1#', '学院路2#'
                , '一起宿舍', '二期宿舍'],
            home: $('.dt-left-nav-box-active').html(),
            event: '',
            type: 0,

            total: 0,//默认数据总数
            pagesize: 11,//每页的数据条数
            currentPage: 1,//默认开始页面
            istag: true,
            tableData: [],
            isXlsx: false,
        },
        methods: {
            // 数据页面
            tableRowClassName({row, rowIndex}) {
                if (rowIndex === 0) {
                    return 'th';
                }
                return '';
            },
            switchChange() {
                this.istag = !this.istag;

            },
            created: function () {
                this.total = this.tableData.length;
            },
            current_change: function (currentPage) {
                this.currentPage = currentPage;
            },

            // end
        },
        created: function () {

            var isLogin = sessionStorage.getItem('isLogin') || false;
            if (!isLogin) {
                window.location.href = 'index';
            }

            $('#daycalendarBoxBegin').val(new Date().format("yyyy-MM-dd"));
            $('#daycalendarBoxEnd').val(new Date().format("yyyy-MM-dd"));
            var args = {
                "home": "00",
                "type": 1,
                "startTime": new Date().format("yyyy-MM-dd").toString(),
                "endhTime": new Date().format("yyyy-MM-dd").toString()
            };
            search(this, args);
        },
        filters: {
            timeFilter: function (value) {
                var time = new Date(value).format('yyyy-MM-dd hh:mm:ss').toString();
                return time;
            }
        }
    });

    function search(obj, args) {
        const loading = obj.$loading({
            lock: true,
            text: '查找数据中',
            spinner: 'el-icon-loading',
            background: 'rgba(0, 0, 0, 0.7)'
        });

        obj.list = [];
        obj.tableData = [];
        obj.home = $('.dt-left-nav-box-active').html();


        var apicode = "AlarmInfo";
        //console.log($('#daycalendarBoxEnd').val()-$('#daycalendarBoxBegin').val());
//        compareDate($('#daycalendarBoxBegin').val(), $('#daycalendarBoxEnd').val());
        if (args.type === 8) {
            apicode = "AlarmBreak";
        }

        axios.post("/api", {
            "apicode": apicode,
            "args": args
        }, {
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(function (res) {
            loading.close();
            if (res.data.obj.length > 0) {
                obj.total = res.data.obj.length;
                var arr = {};
                var event = $("#select").find("option:selected").text();
                var home = $('.dt-left-nav-box-active').html().toString();
                for (var i = 0; i < res.data.obj.length; i++) {
                    arr = {
                        index: i + 1,
                        home: home,
                        boxName: res.data.obj[i].boxName,
                        loopName: res.data.obj[i].loopName,
                        DT: res.data.obj[i].DT,
                        event: event,
                    };
                    obj.tableData[i] = arr;
                }
                if (obj.isXlsx) {
                    var art = [];
                    art = obj.tableData;
                    var sheet = XLSX.utils.json_to_sheet(art);
                    openDownloadDialog(sheet2blob(sheet), obj.home + '.xlsx');
                    obj.isXlsx = false;
                }
            } else {
                loading.close();
                obj.$message.error('暂无当前数据');
            }

        }).catch(function (error) {
            loading.close();
            console.log(error);
        });
    }


    function getWarning() {
        var args = {};
        args['powerType'] = parseInt($("#select").val());
        args['startTime'] = $("#datetimepickerStart").data("datetimepicker").getDate();
        var startTime = args.startTime;
        args.startTime = startTime.getFullYear() + "-" + (startTime.getMonth() + 1) + "-" + startTime.getDate();
        args['endhTime'] = $("#datetimepickerEnd").data("datetimepicker").getDate();
        var endhTime = args.endhTime;
        args.endhTime = endhTime.getFullYear() + "-" + (endhTime.getMonth() + 1) + "-" + endhTime.getDate();
    }

    function getArgs() {
        var startTime = $('#daycalendarBoxBegin').val();
        var endhTime = $('#daycalendarBoxEnd').val();
        var home = homeKeySwitch($('.dt-left-nav-box-active').html().toString());
        var type = parseInt($("#select").val());
        vm.type = type;
        var args = {
            "home": home,
            "type": type,
            "startTime": startTime,
            "endTime": endhTime
        };

        return args;
    }

    function homeKeySwitch(str) {
        var homeKey = '';
        switch (str) {
            case '图书馆':
                homeKey = '00';
                break;
            case '同仁楼':
                homeKey = '01';
                break;
            case '同德楼':
                homeKey = '02';
                break;
            case '同济楼':
                homeKey = '03';
                break;
            case '求是楼':
                homeKey = '09';
                break;
            case '学生活动中心':
                homeKey = '04';
                break;
            case '三期宿舍上':
                homeKey = '06';
                break;
            case '三期宿舍下':
                homeKey = '07';
                break;
            case '中试基地':
                homeKey = '07';
                break;
            case '学院路1#':
                homeKey = '11';
                break;
            case '学院路2#':
                homeKey = '08';
                break;
            case '一期宿舍':
                homeKey = '05';
                break;
            case '二期宿舍':
                homeKey = '06';
                break;
            case '三期宿舍食堂':
                homeKey = '10';
                break;
        }
        return homeKey;
    }

    //时间比较（yyyy-MM-dd）
    function compareDate(startDate, endDate) {
        var arrStart = startDate.split("-");
        var startTime = new Date(arrStart[0], arrStart[1], arrStart[2]);
        var startTimes = startTime.getTime();
        var arrEnd = endDate.split("-");
        var endTime = new Date(arrEnd[0], arrEnd[1], arrEnd[2]);
        var endTimes = endTime.getTime();
        if (endTimes < startTimes) {
            vm.$message({
                message: '结束时间不能小于开始时间',
                type: 'warning'
            });
            return false;
        }
        return true;
    }
</script>
</body>
>>>>>>> dedd623 (first)
>>>>>>> 19b8a9c (first)
>>>>>>> 8f5179a (first)
>>>>>>> 87a8fdf (first)
>>>>>>> 1e8021d (first)
>>>>>>> 5938de4 (first)
>>>>>>> c55f785 (first)
</html>